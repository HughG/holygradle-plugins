public File getDevEnvPath() {
    def envVarComnTools = System.getenv("VS100COMNTOOLS")
    if (envVarComnTools == null || envVarComnTools == "") {
        throw new RuntimeException("'version' was set to '${chosenDevEnvVersion}' but the environment variable '${chosenDevEnvVersion}COMNTOOLS' was null or empty.")
    }
    def comnToolsPath = new File(envVarComnTools)
    def devEnvPath = new File(comnToolsPath, "../IDE/devenv.com")
    if (!devEnvPath.exists()) {
        throw new RuntimeException("DevEnv could not be found at '${devEnvPath}'.")
    }
    devEnvPath
}

task("build", type: Exec) {
    workingDir project.projectDir.path
    commandLine getDevEnvPath().path, "credential-store.sln", "/build", "Release^|Win32"
}

publishSnapshot.dependsOn build
publishRelease.dependsOn build

artifacts {
    it."default" file("Release/credential-store.exe")
}
