buildscript {
    gplugins.use "intrepid:${System.getProperty("holygradle.versionForIntegrationTest")}"
}
gplugins.apply()

group = "holygradle.test"
version = "1.2.3"

configurations {
    explicitFile
    pinnedSource
    packedDependencyByName
    packedDependencyByCoordinate
    selfAsPackedDependencyByCoordinate
    packedDependencyFromSource
    ivyRepository
    withPublishPackages
    text
    withRepublishing
    noCreateDefaultSettingsFile

    toProjectA2
}

repositories {
    ivy {
        url "..\\..\\..\\testUtil\\repository\\"
    }
}

sourceDependencies {
    // Add projectA sourceDependency, without a configuration mapping.  This means it can't be added as a packed
    // dependency in a build script.
    //
    // We have both the target folder and the source repo as the same place, so we don't actually have to fetch source.
    "../projectA" {
        hg new File(project.projectDir, "../projectA").toURI().toString()
    }
    // Add "projectA duplicate" sourceDependency, with a configuration mapping.
    //
    // We have both the target folder and the source repo as the same place, so we don't actually have to fetch source.
    "../projectA2" {
        hg new File(project.projectDir, "../projectA2").toURI().toString()
        configuration "toProjectA2->default"
    }
}

packedDependencies {
    // This test uses noCreateLinkToCache() because we don't actually want to test the fetching
    // unpacking, and linking of dependencies, just the finding of them by name in includeBuildScript.
    "../projectCDep" {    
        dependency "holygradle.test:external-lib:1.0"
        configurations.each { configuration "${it.name}->testRuntime" }
        noCreateLinkToCache()
    }
}

packageArtifacts {
    explicitFile {
        include "dummy.txt"
        includeBuildScript {
        }
    }
    pinnedSource {
        includeBuildScript {
            // Both should work.
            addPinnedSourceDependency "projectA"
            addPinnedSourceDependency "projectA2"
        }
    }
    packedDependencyByName {
        includeBuildScript {
            addPackedDependency "projectCDep", "default"
        }
    }
    packedDependencyByCoordinate {
        includeBuildScript {
            addPackedDependency "holygradle.test:external-lib:1.0", "default->compile"
        }
    }
    selfAsPackedDependencyByCoordinate {
        includeBuildScript {
            addPackedDependency "${project.group}:${project.name}:${project.version}", "default->explicitFile"
        }
    }
    packedDependencyFromSource {
        includeBuildScript {
            // Only projectA2 will work, because only it has a configuration mapping from this project.
            addPackedDependency "projectA2", "default"
        }
    }
    ivyRepository {
        includeBuildScript {
            addIvyRepository "file://nul", "Artifactory"
        }
    }
    withPublishPackages {
        includeBuildScript {
            addPublishPackages "file://nul", "Artifactory"
        } 
    }
    text {
        includeBuildScript {
            add "// This is some sample text"
        }
    }
    withRepublishing {
        includeBuildScript {
            addRepublishing {
                from "file://nul"
                to "file://con"
            }
        } 
    }
    noCreateDefaultSettingsFile {
        createDefaultSettingsFile = false
        includeBuildScript {
            add "// This is some sample text"
        }
    }
}
packageArtifacts.each { it ->
    it.to it.name
}
