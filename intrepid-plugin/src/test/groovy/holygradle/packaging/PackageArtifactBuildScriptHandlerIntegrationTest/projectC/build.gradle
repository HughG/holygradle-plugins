buildscript {
    gplugins.use "intrepid:${System.getProperty("holygradle.versionForIntegrationTest")}"
}
gplugins.apply()

configurations {
    preBuiltArtifacts
    preBuiltArtifactsByCoord
    preBuiltArtifactsBad
}

repositories.ivy {
    url "..\\..\\..\\testUtil\\repository\\"
}

packedDependencies {
    // This test uses noCreateLinkToCache() because we don't actually want to test the fetching
    // unpacking, and linking of dependencies, just the finding of them by name in includeBuildScript.

    // Add a couple of packed dependencies, deliberately make the name of one a substring of the other
    // as a regression test for GR #4543.
    "../projectCDep" {    
        dependency "holygradle.test:external-lib:1.0"
        configuration "preBuiltArtifacts->testRuntime"
        noCreateLinkToCache()
    }
    
    // This one shouldn't appear in the output build script, despite the previous one being an
    // initial-substring match for it.
    "../projectCDepUnwanted" {
        dependency "holygradle.test:example-framework:1.0"
        configuration "preBuiltArtifacts->compileVc10Debug"
        noCreateLinkToCache()
    }        
}

packageArtifacts {
    preBuiltArtifacts {
        to "preBuiltArtifacts"
        includeBuildScript {
            // This should create a packedDependency in the generated build script - before a fix for GR #4543
            // this actually creates the wrong packedDependency (projectCDepUnwanted)
            addPackedDependency "projectCDep", "preBuiltArtifacts->someConfig"
        }
    }
    preBuiltArtifactsByCoord {
        to "preBuiltArtifactsByCoord"
        includeBuildScript {
            addPackedDependency "holygradle.test:external-lib:1.0", "preBuiltArtifacts->someConfig"
        }
    }
    preBuiltArtifactsBad {
        to "preBuiltArtifactsBad"
        includeBuildScript {
            addPackedDependency "nonExistentPackedDep", "preBuiltArtifacts->someConfig"
        }
    }
}