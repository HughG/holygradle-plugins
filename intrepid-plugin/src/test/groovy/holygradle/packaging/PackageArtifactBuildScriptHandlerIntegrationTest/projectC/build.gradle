buildscript {
    gplugins.use "intrepid:${System.getProperty("holygradle.versionForIntegrationTest")}"
}
gplugins.apply()

configurations {
    preBuiltArtifacts
}

repositories.ivy {
    url "..\\..\\..\\testUtil\\repository\\"
}

packedDependencies {
    // This test uses noCreateSymlinkToCache() because we don't actually want to test the fetching
    // unpacking, and symlinking of dependencies, just the finding of them by name in includeBuildScript.

    // Add a couple of packed dependencies, deliberately make the name of one a substring of the other
    // as a regression test for GR #4543.
    "../projectCDep" {    
        dependency "holygradle.test:external-lib:1.0"
        configuration "preBuiltArtifacts->testRuntime"
        noCreateSymlinkToCache()
    }
    
    // This one shouldn't appear in the output build script, despite the previous one being an
    // initial-substring match for it.
    "../projectCDepUnwanted" {
        dependency "holygradle.test:example-framework:1.0"
        configuration "preBuiltArtifacts->compileVc10Debug"
        noCreateSymlinkToCache()
    }        
}

packageArtifacts {
    preBuiltArtifacts {
        to "preBuiltArtifacts"
        // We need to include at least one pre-existing file, or the build script generation doesn't run. GR #3080
        include "dummy.txt"
        includeBuildScript {
            add "// Meta-package for ${project.name} pre-built artifacts ${project.version}"
            add "// ---------------------------------------------------"
            //addIvyRepository "TODO", "Artifactory"
            
            // This should create a packedDependency in the generated build script - before a fix for GR #4543
            // this actually creates the wrong packedDependency (projectCDepUnwanted)
            addPackedDependency "projectCDep", "preBuiltArtifacts->someConfig"
        }
    }
}